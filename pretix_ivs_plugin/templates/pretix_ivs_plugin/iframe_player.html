<!DOCTYPE html>
<html>
<head>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: black; overflow: hidden; }
        #video-player { width: 100%; height: 100%; }
    </style>
    <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?version=4.8.0&features=es2015%2Ces2016%2Ces2017%2CURL%2CBlob%2CObject.assign%2CIntersectionObserver%2CIntersectionObserverEntry%2CPromise"></script>
    <script src="https://player.live-video.net/1.16.0/amazon-ivs-player.min.js"></script>
</head>
<body>
    <video id="video-player" controls playsinline></video>
    <script>
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const streamUrl = urlParams.get('url');
            let retryTimeout;

            function init() {
                const PlayerFactory = IVSPlayer.create ? IVSPlayer : window.IVSPlayer;
                const sdkSupport = typeof PlayerFactory !== 'undefined' && PlayerFactory.isPlayerSupported && window.FileReader !== 'undefined';

                if (sdkSupport) {
                    const player = IVSPlayer.create({
                        optimizeBackgroundPlayback: { enabled: true }
                    });
                    player.attachHTMLVideoElement(document.getElementById('video-player'));

                    player.addEventListener(IVSPlayer.PlayerEventType.ERROR, (err) => {
                        console.warn("Player Error:", err.message);
                        if (err.code === 404 || err.message.includes('playlist')) { 
                            console.log("Stream might be offline. Retrying in 10 seconds...");
                            clearTimeout(retryTimeout);
                            retryTimeout = setTimeout(() => {
                                player.load(streamUrl);
                                player.play();
                            }, 10000);
                        }
                    });

                    player.addEventListener(IVSPlayer.PlayerState.PLAYING, () => {
                        console.log("Stream is live!");
                        clearTimeout(retryTimeout);
                    });

                    player.load(streamUrl);
                    player.play();
                } else {
                    console.warn("SDK blocked or FileReader missing. Falling back to native HLS.");
                    const videoElement = document.getElementById('video-player');
                    videoElement.src = streamUrl;
                    videoElement.muted = true;
                    videoElement.play().catch(err => {
                        console.log("Native playback waiting for user interaction (click play).");
                    });
                }
            }

            if (document.readyState === 'complete') {
                init();
            } else {
                window.addEventListener('load', init);
            }
        })();
    </script>
</body>
</html>
